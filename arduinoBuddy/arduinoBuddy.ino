#include <Adafruit_Sensor.h>
#include <DHT.h>
#include <DHT_U.h>
#include <ESP8266HTTPClient.h>
#include <ArduinoJson.h>
#include <WiFiClientSecure.h>
#include <SPI.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SH110X.h>

//dht11
#define DHTPIN 3    // Digital pin connected to the DHT sensor, D2 
#define DHTTYPE    DHT11     // DHT 11
DHT dht(DHTPIN, DHTTYPE);
//oled
#define i2c_Address 0x3c //initialize with the I2C addr 0x3C Typically eBay OLED's
#define SCREEN_WIDTH 128 // OLED display width, in pixels
#define SCREEN_HEIGHT 64 // OLED display height, in pixels
#define OLED_RESET -1   //   QT-PY / XIAO
Adafruit_SH1106G display = Adafruit_SH1106G(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);
#define NUMFLAKES 10
#define XPOS 0
#define YPOS 1
#define DELTAY 2
//wifimanager
#include <ESP8266WiFi.h>
#include <WiFiManager.h>
WiFiManager manager;
String deviceIDName = "";
WiFiManagerParameter parameter("parameterId", "Device ID", "", 3);
WiFiManagerParameter parameteremail("parameterEmail", "Registered Email", "", 40);
//button
#define buttonWiFiPin 2 //D4 blue
#define buttonModePin 0 //D3 red 
int buttonPressStatus = 0;
// int buttonState = 0;         // variable for reading the pushbutton status
// int buttonPin = 2; //0
//post http
WiFiClientSecure wifiClient;
int timeout = 30;
String deviceID;
String deviceEmail;
const char* url = "https://com-4-rt.vercel.app/api/log_data.json";
//RGB
int red_light_pin= 14; //D5
int green_light_pin = 12; //D6
int blue_light_pin = 13; //D7
//buzzer
const int buzzer = 10; //buzzer to SD3
int countBuzzer = 0;
//reading
float humi;
float tempC;
float belowHumi = 40;
float aboveHumi = 70;
float belowTempC = 20;
float aboveTempC = 26;

float aboveHeat = 30;

float heatIndex;
// 'water', 10x16px
const unsigned char humiBitMap [] PROGMEM = {
	0x00, 0x00, 0x08, 0x00, 0x1c, 0x00, 0x1c, 0x00, 0x3e, 0x00, 0x36, 0x00, 0x77, 0x00, 0x63, 0x00, 
	0x63, 0x80, 0xe1, 0x80, 0xe1, 0x80, 0x63, 0x80, 0x77, 0x00, 0x3f, 0x00, 0x1c, 0x00, 0x00, 0x00
};


// 'temp22', 10x16px
const unsigned char tempBitMap [] PROGMEM = {
	0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00, 
	0x0c, 0x00, 0x1e, 0x00, 0x12, 0x00, 0x00, 0x00, 0x21, 0x00, 0x21, 0x00, 0x12, 0x00, 0x1e, 0x00
};


// 'wifi', 16x16px
const unsigned char wifiBitMap [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x3f, 0xfc, 0x78, 0x1e, 0xe3, 0xc7, 0x4f, 0xf2, 0x1f, 0xf8, 
	0x18, 0x18, 0x03, 0xc0, 0x07, 0xe0, 0x00, 0x00, 0x01, 0x80, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00
};

// 'comfort1-removebg-preview', 70x47px
const unsigned char comfortBitMap [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xc0, 0x1f, 
	0xff, 0xff, 0xe0, 0x00, 0x7f, 0xff, 0xff, 0xe0, 0x7f, 0xff, 0xff, 0xf8, 0x01, 0xff, 0xff, 0xff, 
	0xe0, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 
	0xff, 0xff, 0xc0, 0x3f, 0xff, 0xff, 0xff, 0x9f, 0xff, 0xff, 0xff, 0x80, 0x1f, 0xff, 0xff, 0xff, 
	0x0f, 0xff, 0xff, 0xff, 0x00, 0x0f, 0xff, 0xff, 0xfe, 0x07, 0xff, 0xff, 0xff, 0x00, 0x0f, 0xff, 
	0xff, 0xfe, 0x07, 0xff, 0xff, 0xff, 0x00, 0x0f, 0xff, 0xff, 0xfe, 0x07, 0xff, 0xff, 0xff, 0x00, 
	0x07, 0xff, 0xff, 0xfc, 0x07, 0xff, 0xff, 0xfe, 0x00, 0x07, 0xff, 0xff, 0xfc, 0x03, 0xff, 0xff, 
	0xfe, 0x00, 0x07, 0xff, 0xff, 0xfc, 0x03, 0xff, 0xff, 0xfe, 0x00, 0x07, 0xff, 0xff, 0xfc, 0x03, 
	0xff, 0xff, 0xfe, 0x00, 0x03, 0xff, 0xff, 0xf8, 0x01, 0xff, 0xff, 0xfc, 0x00, 0x03, 0xff, 0xff, 
	0xf8, 0x01, 0xff, 0xff, 0xfc, 0x00, 0x01, 0xff, 0xff, 0xf0, 0x00, 0xff, 0xff, 0xf8, 0x00, 0x01, 
	0xff, 0xff, 0xe0, 0x00, 0x7f, 0xff, 0xf8, 0x00, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x3f, 0xff, 0xf0, 
	0x00, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x1f, 0xff, 0xc0, 0x00, 0x00, 0x0f, 0xfe, 0x00, 0x00, 0x07, 
	0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 
	0x01, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x1f, 
	0x80, 0x00, 0x1f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x01, 0xff, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x0f, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xfc, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xe0, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xff, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 
	0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


// 'abnormal_withoutSweat', 70x48px
const unsigned char uncomfortBitMap [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x0e, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x00, 
	0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
	0xc0, 0x00, 0x0f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xc0, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 
	0x00, 0x7f, 0x80, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x00, 0x03, 0xfe, 0x00, 0x00, 0x00, 0xff, 0x80, 
	0x00, 0x0e, 0x03, 0xf8, 0x00, 0x00, 0x00, 0x3f, 0x80, 0xe0, 0x1e, 0x01, 0x00, 0x00, 0x00, 0x00, 
	0x02, 0x01, 0xe0, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x0f, 0x80, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x03, 0xe0, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x03, 0xe0, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x80, 0x01, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x00, 
	0x00, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x07, 0xfc, 0x00, 0x00, 0x1f, 0xff, 0x00, 0x00, 0x03, 0xff, 
	0xf0, 0x00, 0x00, 0x07, 0xff, 0x80, 0x00, 0x07, 0xff, 0x80, 0x00, 0x0f, 0x00, 0x7f, 0x80, 0x00, 
	0x03, 0xfc, 0x01, 0xe0, 0x0f, 0xff, 0xff, 0x00, 0x00, 0x01, 0xff, 0xff, 0xe0, 0x07, 0xff, 0xf8, 
	0x00, 0x00, 0x00, 0x7f, 0xff, 0xc0, 0x01, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x0f, 0xfe, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x0e, 0x00, 0xe0, 0x0e, 0x00, 
	0x00, 0x00, 0x03, 0xf8, 0x3f, 0x83, 0xf8, 0x3f, 0x80, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 
	0xff, 0xe0, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x7e, 0x0f, 0xe0, 
	0xfe, 0x0f, 0xe0, 0xf8, 0x00, 0x00, 0x38, 0x03, 0x80, 0x38, 0x03, 0x80, 0x38, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
	
// 'cat', 48x45px
const unsigned char catBitMap [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x10, 0x00, 0x00, 0x00, 0x0f, 0x80, 0x70, 0x00, 0x00, 
	0x00, 0x0f, 0xe1, 0xf0, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xf0, 
	0x00, 0x00, 0x00, 0x1f, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x1b, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x10, 
	0xfc, 0x70, 0x00, 0x00, 0x00, 0x18, 0x78, 0x70, 0x00, 0x00, 0x00, 0x1c, 0x70, 0xf0, 0x00, 0x00, 
	0x00, 0x1e, 0x71, 0xf0, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xf0, 0x00, 0x00, 0x01, 0xff, 0xff, 0xf0, 
	0x00, 0x00, 0x07, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x1f, 0xff, 
	0xff, 0xf0, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xf0, 0x00, 0x00, 
	0x7f, 0xf0, 0xff, 0xf0, 0x07, 0x00, 0xff, 0xc0, 0x3f, 0xf0, 0x1f, 0xc0, 0xff, 0x80, 0x1f, 0xf0, 
	0x3f, 0xe0, 0xff, 0x00, 0x0f, 0xf0, 0x27, 0xe1, 0xfe, 0x00, 0x07, 0xf0, 0x01, 0xe1, 0xfe, 0x00, 
	0x07, 0xf0, 0x00, 0xf1, 0xfe, 0x00, 0x07, 0xf0, 0x00, 0xf1, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x71, 
	0xfe, 0x00, 0x00, 0x00, 0x00, 0x31, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x39, 0xfe, 0x00, 0x00, 0x00, 
	0x00, 0x38, 0xff, 0x00, 0x00, 0x00, 0x00, 0x18, 0xff, 0x00, 0x00, 0x00, 0x00, 0x1c, 0xff, 0x80, 
	0x00, 0x00, 0x00, 0x0c, 0x7f, 0xf0, 0x00, 0x00, 0x00, 0x0e, 0x7f, 0xff, 0xff, 0xe0, 0x00, 0x07, 
	0x3f, 0xff, 0xff, 0xe0, 0x00, 0x07, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x03, 0xff, 0xff, 0xff, 0xe0, 
	0x00, 0x00, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x0f, 0xff, 
	0xff, 0xe0, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


void postHTTP(String(url), String(tempReading), String(humdReading), String(deviceName),String(Email));
void setup() {
  Serial.begin(115200);
  pinMode(DHTPIN, FUNCTION_0);
  pinMode (buzzer, OUTPUT) ;// set the digital IO pin mode,
  pinMode(buttonWiFiPin, INPUT);
  pinMode(buttonModePin, INPUT);
  pinMode(red_light_pin, OUTPUT);
  pinMode(green_light_pin, OUTPUT);
  pinMode(blue_light_pin, OUTPUT);

  //For DHT11
  dht.begin();
  //For OLED I2C
  display.begin(i2c_Address, true); // Address 0x3C default
  //display.setContrast (0); // dim display
  display.clearDisplay();
  oledDisplayHeader(2, 28,0, "COM4RT");
  display.drawBitmap(42, 16, catBitMap, 48, 45, SH110X_WHITE); // display.drawBitmap(x position, y position, bitmap data, bitmap width, bitmap height, color)
  display.display();  //can put our company logo
  delay(2000);
  // Clear the buffer.
  display.clearDisplay();
  // Initialize device.
  dht.begin();
  wifiClient.setInsecure();  //the magic line, use with caution
  manager.addParameter(&parameter);
  manager.addParameter(&parameteremail);
  // deviceID = parameter.getValue();
  }

void loop() {
  delay(100);
  humi = dht.readHumidity();
  tempC = dht.readTemperature();


  heatIndexCalculation();

  buttonMode();
  buttonWiFi();
  // readingOutput();
  conditionDisplay();
  display.display(); 
  Serial.println(humi);
  Serial.println(tempC);
  deviceID = parameter.getValue();
  deviceEmail = parameteremail.getValue();
  Serial.println(deviceID);
  Serial.println(deviceEmail);


  String tempString = String(tempC, 1);
  String humdString = String(humi, 0);  
  postHTTP(url, tempString, humdString, deviceID,deviceEmail);}


void heatIndexCalculation(){
  float c1 = -8.7847;
  float c2= 1.6114;
  float c3 = 2.3385;
  float c4 = -0.1461;
  float c5 = -0.0123;
  float c6 = -0.0164;
  float c7 = 2.2117 * pow(10,-3);
  float c8 = 7.2546 * pow(10,-4);
  float c9 = -3.5820 * pow(10,-6);
  float T = tempC;
  float R = humi;
  
  heatIndex = c1+c2*T+c3*R+c4*T*R+c5*sq(T)+c6*sq(R)+c7*sq(T)*R+c8*T*sq(R)+c9*sq(T)*sq(R);
  Serial.println(heatIndex);

} 



void wifiLogoDisplay(){
  if (WiFi.status() == WL_CONNECTED){ 
  display.drawBitmap(5,0, wifiBitMap, 16, 16, SH110X_WHITE);  
  }
}

void comfortDisplay(){  display.clearDisplay();
  display.clearDisplay();
  oledDisplay(1,41,52,humi,"%");  //total size 36 hori 16 verti
  oledDisplay(1,79,52,tempC,"C");//total size 36 + 8 = 44 
  display.drawBitmap(26,48, humiBitMap, 10, 16, SH110X_WHITE); // display.drawBitmap(x position, y position, bitmap data, bitmap width, bitmap height, color)
  display.drawBitmap(64, 48, tempBitMap, 10, 16, SH110X_WHITE); // display.drawBitmap(x position, y position, bitmap data, bitmap width, bitmap height, color)
  display.drawBitmap(29, 0, comfortBitMap, 70,47, SH110X_WHITE);  //next time chg the pic to 70*48 
  wifiLogoDisplay();
    display.display();}

void uncomfortDisplay(){  display.clearDisplay();
  display.clearDisplay();
  oledDisplay(1,41,52,humi,"%");  //total size 36 hori 16 verti
  oledDisplay(1,79,52,tempC,"C");//total size 36 + 8 = 44 
  display.drawBitmap(26,48, humiBitMap, 10, 16, SH110X_WHITE); // display.drawBitmap(x position, y position, bitmap data, bitmap width, bitmap height, color)
  display.drawBitmap(64, 48, tempBitMap, 10, 16, SH110X_WHITE); // display.drawBitmap(x position, y position, bitmap data, bitmap width, bitmap height, color)
  display.drawBitmap(29, 0, uncomfortBitMap, 70,48, SH110X_WHITE);
  wifiLogoDisplay();
  display.display();}

void oledDisplayHeader(int size, int x,int y, String word){
 display.setTextSize(size);
 display.setTextColor(SH110X_WHITE);
 display.setCursor(x, y);
 display.print(word);}


void oledDisplay(int size, int x,int y, float value, String unit){
 int charLen=6;  //use 6 when set text size as 1, 12 for 2 and 18 for 3
 int xo=x+charLen*3.2;
 int xunit=x+charLen*3.6;
 int xval = x; 
 display.setTextSize(size);
 display.setTextColor(SH110X_WHITE);
 
 if (unit=="%"){
   display.setCursor(x, y);
   display.print(value,0);
   display.print(unit);
 } else {
   if (value>99){
    xval=x;
   } else {
    xval=x;  //original is x+charlen
   }
   display.setCursor(xval, y);
   display.print(value,0);
   display.drawCircle(xo-6, y+2, 2, SH110X_WHITE );  // print degree symbols (  )  //-6 if text size is 1
   display.setCursor(xunit-6, y);
   display.print(unit);
 }
 }

void RGB_color(int red_light_value, int green_light_value, int blue_light_value){
  
  analogWrite(red_light_pin, red_light_value);
  analogWrite(green_light_pin, green_light_value);
  analogWrite(blue_light_pin, blue_light_value);}

void wifiManager(){   //set up only 
      manager.resetSettings();
      manager.setCustomHeadElement("COM4RT");   
      manager.setDebugOutput(false);      
      // manager.addParameter(&parameter);
      manager.setClass("invert");     // dark theme
      std::vector<const char*> menu = { "wifi", "exit" };
      manager.setMenu(menu);
      manager.autoConnect("COM4RT");
      
         if(manager.autoConnect("COM4RT")){
          Serial.println("connected...yeey :)");
          digitalWrite(buzzer, HIGH);
          delay(500);
          digitalWrite(buzzer, LOW);
          delay(500);
        }
        else {
            Serial.println("Configportal running");
        }
  }



void blinkLed(){
  RGB_color(255, 0, 0);  // red
  delay(1000);
  RGB_color(0, 0, 0);  // off
  delay(1000);}

void buzzerLight(){
  digitalWrite(buzzer, HIGH);
  delay(500);
  digitalWrite(buzzer, LOW);
  delay(500);}



void singleclick(){
  Serial.println("singlepressed");
  RGB_color(255, 0, 0);  // red
  delay(500);
  RGB_color(0, 0, 0);  // off
  delay(500);
  manager.disconnect();
  delay(500);
  if (WiFi.status() != WL_CONNECTED){ 
    delay(200); 
    Serial.print("disconnected...:(");  //press second time only disconnect bug
    }
  else{
    Serial.print("connected...yeey :)");
    digitalWrite(buzzer, HIGH);
    delay(500);
    digitalWrite(buzzer, LOW);
    delay(500);
    Serial.println(WiFi.localIP());
    Serial.println();
  }

  }


void longclick(){
  Serial.println("longpressed");
  RGB_color(255, 0, 0);  // red
  delay(500);
  RGB_color(0, 0, 0);  // off
  delay(500);
  manager.autoConnect("COM4RT");
  while (WiFi.status() != WL_CONNECTED){ 
    delay(200); 
    Serial.println("disconnected...:(");
    Serial.print("."); 
    }
  Serial.print("connected...yeey :)");
  digitalWrite(buzzer, HIGH);
  delay(500);
  digitalWrite(buzzer, LOW);
  delay(500);
  Serial.println(WiFi.localIP());
  Serial.println();
  }


void buttonMode(){
  int buttonStateMode = digitalRead(buttonModePin);
  delay(550);
    // check if the pushbutton is pressed. If it is, the buttonState is HIGH:
  if (buttonStateMode == HIGH) {  //havnt pressed
    digitalWrite(buzzer, LOW);
    delay(500);
    digitalWrite(buzzer, LOW);
    Serial.println("Off");
    //    sound();
  } else {
    // pressed:
    buttonPressStatus +=1; 
    Serial.println("Mode button on: "+ String(buttonPressStatus));
    Serial.print(buttonPressStatus);
    digitalWrite(buzzer, HIGH);
    RGB_color(255,0,0);
    delay(500);
    digitalWrite(buzzer, LOW);
    RGB_color(0,0,0);
  }
  delay(100);
  
  if (buttonPressStatus%2 == 0 and buttonPressStatus>0 ){  //should be connected
    manager.autoConnect("COM4RT");
      while (WiFi.status() != WL_CONNECTED){ 
        delay(200); 
        Serial.println("disconnected...:(");
        digitalWrite(buzzer, HIGH);  // if have buzzer means not work properly
        delay(500);
        digitalWrite(buzzer, LOW);
        delay(500);
        }
      Serial.print("connected...yeey :)");
      Serial.println(WiFi.localIP());
      Serial.println();
  }
  else if (buttonPressStatus%2 == 1 and buttonPressStatus>0){  //should be disconnected
    manager.disconnect();
      delay(500);
      if (WiFi.status() != WL_CONNECTED){ 
        delay(200); 
        Serial.print("disconnected...:(");  //press second time only disconnect bug
        }
      else{
      Serial.print("connected...yeey :)");
      Serial.println(WiFi.localIP());
      Serial.println();
      digitalWrite(buzzer, HIGH);  // if have buzzer means not work properly
      delay(500);
      digitalWrite(buzzer, LOW);
      delay(500);
      }}}
void postHTTP(String(url), String(tempReading), String(humdReading), String(deviceName), String(Email)) {
  
  unsigned long delay_datasent = 55000;  // 55sec
  HTTPClient http;
  String response;

  http.begin(wifiClient, url);
  StaticJsonDocument<200> buff;
  String jsonParams;

  http.addHeader("Content-Type", "application/json");
  //  int httpResponseCode = http.POST("{\"device_id\":\"VERCEL\",\"temp\":\"33.3\",\"humidity\":\"24.25\"}");
  buff["email"] = Email;
  buff["device_id"] = deviceName;
  buff["temp"] = tempReading;
  buff["humidity"] = humdReading;
  serializeJson(buff, jsonParams);
  delay(delay_datasent);
  http.POST(jsonParams);
  response = http.getString();
  Serial.println(response);
  http.end();}

void buttonWiFi(){
  int buttonStateWiFi = digitalRead(buttonWiFiPin);
  delay(550);
  // check if the pushbutton is pressed. If it is, the buttonState is HIGH:
  if (buttonStateWiFi == HIGH) {
    digitalWrite(buzzer, LOW);
    delay(500);
    digitalWrite(buzzer, LOW);
    Serial.println("Off");
  //    sound();
  } else {
    // turn LED off:
    digitalWrite(buzzer, HIGH);
    RGB_color(255,0,0);
    delay(500);
    digitalWrite(buzzer, LOW);
    RGB_color(0,0,0);
    Serial.println("On");
    wifiManager();
  }}

// void readingOutput(){
//   if(heatIndex <= aboveHeat){
//       delay(1000);
//       RGB_color(255,0,255); // g
//     }
//     else if(tempC > aboveTempC){
//       delay(1000);
//       RGB_color(0,255,255); // r
//       }
// }

void conditionDisplay(){
  if(heatIndex <= aboveHeat){
    delay(1000);
    RGB_color(255,0,255); // g
    countBuzzer = 0;
    comfortDisplay();
  }
  else{
    delay(1000);
    RGB_color(0,255,255); // r
    countBuzzer += 1;
    if (countBuzzer <=3){
    buzzerLight();
    }
    uncomfortDisplay();}
    Serial.print("count buzzer");
    Serial.println(countBuzzer);

    }

